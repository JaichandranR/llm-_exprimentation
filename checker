package net.jpmchase.csorion.config.ida;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.*;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.Mock;
import org.mockito.MockitoAnnotations;
import org.springframework.boot.test.context.runner.ApplicationContextRunner;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.web.client.RestTemplate;
import org.springframework.web.client.RestTemplateBuilder;

class IdaClientConfigurationTest {

    @Mock
    private IdaClientProperties mockProperties;

    private IdaClientConfiguration config;

    @BeforeEach
    void setUp() {
        MockitoAnnotations.openMocks(this);
        when(mockProperties.resourceUri()).thenReturn("https://example.com/resource");
        when(mockProperties.providerUrl()).thenReturn("https://example.com/provider");

        config = new IdaClientConfiguration(mockProperties);
    }

    @Test
    void testC2cIdaTokenProviderBean() {
        IdaTokenProvider tokenProvider = config.c2cIdaTokenProvider();
        assertNotNull(tokenProvider, "Token provider should not be null");
        // The provider will have fetchTokenOnBuild(true) and awsRegion = "us-east-1"
    }

    @Test
    void testC2cRestTemplateBean() {
        RestTemplateBuilder restTemplateBuilder = mock(RestTemplateBuilder.class, RETURNS_SELF);
        IdaTokenProvider tokenProvider = mock(IdaTokenProvider.class);

        RestTemplate restTemplate = config.restTemplate(restTemplateBuilder, tokenProvider);
        assertNotNull(restTemplate, "RestTemplate should not be null");
    }

    @Test
    void testGetRestTemplateBean() {
        RestTemplate restTemplate = config.getRestTemplate();
        assertNotNull(restTemplate, "RestTemplate should not be null");
    }
}
