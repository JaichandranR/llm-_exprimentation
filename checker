@ExtendWith(MockitoExtension.class)
class RequestHandlerClientServiceImplTest {

    @Mock
    private RestTemplate c2dcRestTemplate;

    @Mock
    private IdaTokenProvider idaTokenProvider;

    @Mock
    private IdaTokenResponse idaTokenResponse;

    @InjectMocks
    private RequestHandlerClientServiceImpl service;

    @Test
    void testPostQueryToTrino() {
        // Arrange
        when(idaTokenProvider.get()).thenReturn(idaTokenResponse);
        when(idaTokenResponse.getAccessToken()).thenReturn("fake-token");
        when(c2dcRestTemplate.postForObject(
                contains("/v1/statement"),
                any(HttpEntity.class),
                eq(String.class)
        )).thenReturn("mocked-response");

        // Act
        String result = service.PostQueryToTrino("SELECT 1");

        // Assert
        assertEquals("mocked-response", result);

        verify(c2dcRestTemplate).postForObject(
                contains("/v1/statement"),
                any(HttpEntity.class),
                eq(String.class)
        );
    }
}
