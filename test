{% macro get_schema_uri(schema_name) %}
    {% set uri_query %}
        SHOW CREATE SCHEMA {{ schema_name }};
    {% endset %}

    {% set results = run_query(uri_query) %}

    {% if execute %}
        {% if results and results.columns[0].values() %}
            {% set ddl = results.columns[0].values()[0] %}

            {% set uri = 'https://default-url.gaiacloud.jpmchase.net' %}  {# Default fallback #}

            {% if ddl is not none %}
                {% set regex_pattern = "uri\\s*=\\s*'([^']+)'" %}
                {% set match = modules.re.search(regex_pattern, ddl) %}
                
                {% if match %}
                    {% set uri = match.group(1) %}
                {% endif %}
            {% endif %}

            {% do log("Extracted URI: " ~ uri, info=true) %}
        {% else %}
            {% do log("No URI found, using default.", info=true) %}
            {% set uri = 'https://default-url.gaiacloud.jpmchase.net' %}
        {% endif %}
    {% else %}
        {% set uri = 'https://default-url.gaiacloud.jpmchase.net' %}
    {% endif %}

    {{ return(uri) }}
{% endmacro %}
