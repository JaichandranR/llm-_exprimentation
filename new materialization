{% materialization external_table, adapter='trino' %}
  {% set location = config.get('location') %}
  {% set format = config.get('format', 'parquet') %}

  {% set identifier = model.identifier %}
  {% if identifier[0].isdigit() %}
    {% set identifier = '"' ~ identifier ~ '"' %}
  {% endif %}

  {% set fq_table_name = model.database ~ '.' ~ model.schema ~ '.' ~ identifier %}

  {% set create_statement %}
    CREATE TABLE IF NOT EXISTS {{ fq_table_name }}
    WITH (
      location = '{{ location }}',
      format = '{{ format }}'
    )
    AS {{ sql }}
  {% endset %}

  {{ log("Running external CTAS:", info=True) }}
  {{ log("Create statement:\n" ~ create_statement, info=True) }}

  {{ run_query(create_statement) }}

  {{ return({'relations': [model]}) }}
{% endmaterialization %}



{{ config(materialized='external_table', location='s3://app-id-90177-dep-id-114232-uu-id-du8vur5fx06i/archer_manual_folder_1/', format='parquet') }}

SELECT
  a.creation_date_displayname AS creation_date_displayname,
  a.last_updated_date AS last_updated_date,
  a.last_updated_username AS last_updated_username
FROM archer.dbo.application AS a
WHERE FALSE
