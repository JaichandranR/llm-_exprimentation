{% materialization external_table, default %}

  {% set identifier = model.identifier %}
  {% set schema = model.schema %}
  {% set database = model.database %}
  {% set location = config.get('location') %}
  {% set format = config.get('format', 'parquet') %}

  {% set fq_table = database ~ '.' ~ schema ~ '.' ~ identifier %}

  {% set create_statement %}
    CREATE TABLE IF NOT EXISTS {{ fq_table }}
    WITH (
      location = '{{ location }}',
      format = '{{ format }}'
    )
    AS
    {{ sql }}
  {% endset %}

  {{ log("Running external CTAS:", info=True) }}
  {{ log(create_statement, info=True) }}
  {% do run_query(create_statement) %}

  {{ return({'relations': [this]}) }}

{% endmaterialization %}





{{ config(materialized='external_table', location='s3://your-location/', format='parquet') }}

WITH source_data AS (
  SELECT
    a.creation_date_displayname AS creation_date_displayname,
    a.last_updated_date AS last_updated_date,
    a.last_updated_username AS last_updated_username
  FROM archer.dbo.application AS a
  WHERE FALSE
)

SELECT * FROM source_data
