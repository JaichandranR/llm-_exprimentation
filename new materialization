id: trp_application_risk_info
namespace: core-services

tasks:
  # ðŸ”¹ TODAY (with full refresh)
  - id: today_trp_run
    type: dbt.v2.Run
    command: >
      dbt run -m trp_application_risk_info --full-refresh --vars '{"CALCULATION_DATE": "{% if now() | date("dd") != "01" %}{{ now() | date("yyyy-MM-dd") }}{% else %}{{ now() | date("yyyy-MM-dd") }}{% endif %}"}'

  - id: today_raw_run
    type: dbt.v2.Run
    command: 'dbt run -m raw_103662_trp_application_risk_info --full-refresh'

  # ðŸ”¹ STATIC RUNS FOR PREVIOUS MONTHS (no full refresh)
  - id: m1_trp_run
    type: dbt.v2.Run
    command: >
      dbt run -m trp_application_risk_info --cache-selected-only --vars '{"CALCULATION_DATE": "{{ now() | dateAdd(-1, "MONTHS") | date("yyyy-MM-01") }}"}'

  - id: m1_raw_run
    type: dbt.v2.Run
    command: 'dbt run -m raw_103662_trp_application_risk_info --cache-selected-only'

  - id: m2_trp_run
    type: dbt.v2.Run
    command: >
      dbt run -m trp_application_risk_info --cache-selected-only --vars '{"CALCULATION_DATE": "{{ now() | dateAdd(-2, "MONTHS") | date("yyyy-MM-01") }}"}'

  - id: m2_raw_run
    type: dbt.v2.Run
    command: 'dbt run -m raw_103662_trp_application_risk_info --cache-selected-only'

  - id: m3_trp_run
    type: dbt.v2.Run
    command: >
      dbt run -m trp_application_risk_info --cache-selected-only --vars '{"CALCULATION_DATE": "{{ now() | dateAdd(-3, "MONTHS") | date("yyyy-MM-01") }}"}'

  - id: m3_raw_run
    type: dbt.v2.Run
    command: 'dbt run -m raw_103662_trp_application_risk_info --cache-selected-only'

  - id: m4_trp_run
    type: dbt.v2.Run
    command: >
      dbt run -m trp_application_risk_info --cache-selected-only --vars '{"CALCULATION_DATE": "{{ now() | dateAdd(-4, "MONTHS") | date("yyyy-MM-01") }}"}'

  - id: m4_raw_run
    type: dbt.v2.Run
    command: 'dbt run -m raw_103662_trp_application_risk_info --cache-selected-only'

  - id: m5_trp_run
    type: dbt.v2.Run
    command: >
      dbt run -m trp_application_risk_info --cache-selected-only --vars '{"CALCULATION_DATE": "{{ now() | dateAdd(-5, "MONTHS") | date("yyyy-MM-01") }}"}'

  - id: m5_raw_run
    type: dbt.v2.Run
    command: 'dbt run -m raw_103662_trp_application_risk_info --cache-selected-only'

  - id: m6_trp_run
    type: dbt.v2.Run
    command: >
      dbt run -m trp_application_risk_info --cache-selected-only --vars '{"CALCULATION_DATE": "{{ now() | dateAdd(-6, "MONTHS") | date("yyyy-MM-01") }}"}'

  - id: m6_raw_run
    type: dbt.v2.Run
    command: 'dbt run -m raw_103662_trp_application_risk_info --cache-selected-only'
