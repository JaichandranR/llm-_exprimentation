üõ†Ô∏è I Will Give You the Dedup Logic + Updated Script Snippet
Add this before merge:
# -------------------------------------------------------------------
#  DEDUPLICATION LOGIC (IMPORTANT)
# -------------------------------------------------------------------
def dedupe_records(df):
    if df.empty:
        return df
    df = df.drop_duplicates(
        subset=[
            "parent_model", "parent_project", "child_model",
            "child_project", "relation_type", "parent_fqn", "child_fqn"
        ],
        keep="last"
    )
    logging.info(f"After dedup: {len(df)} rows")
    return df

And call it BEFORE merge:
df = parse_dependencies(manifest_paths, registry)
df = dedupe_records(df)        # <----- REQUIRED
merge_records(cursor, catalog, schema, df, batch_size=100)

üéØ Updated Code Section for Main Workflow

Here is exactly what your bottom section should look like:

# -------------------------------------------------------------------
# MAIN WORKFLOW
# -------------------------------------------------------------------
if __name__ == "__main__":

    teams = [
        "core-services", "core-services-hcd", "cyber-ops", "dfas", "gt-metrics",
        "intel", "resiliency", "techgrc", "aa", "assurance", "dlp", "ccm", "tpr"
    ]

    manifest_paths = [f"manifests/manifest_{t}.json" for t in teams]

    for t, p in zip(teams, manifest_paths):
        fetch_manifest(t, p)

    # Build registry
    registry = build_registry(manifest_paths)

    # Parse all dependencies
    df = parse_dependencies(manifest_paths, registry)

    # üî• DEDUPE BEFORE MERGE (REQUIRED)
    df = dedupe_records(df)

    # Connect to Trino
    conn, catalog, schema = load_dbt_trino_profile(
        profile_path="C:/Users/R732325/ds/projects/dbt-jules/dbt-models-core-services/.dbt/profiles.yml"
    )
    cursor = conn.cursor()

    # Create table
    create_lineage_table(cursor, catalog, schema)

    # Insert/merge in batches
    merge_records(cursor, catalog, schema, df, batch_size=100)

    logging.info("Lineage extraction completed successfully.")
