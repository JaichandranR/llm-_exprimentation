import sys
from awsglue.context import GlueContext
from pyspark.context import SparkContext
import boto3

# Initialize Glue context
sc = SparkContext()
glueContext = GlueContext(sc)
spark = glueContext.spark_session

# S3 path to check
s3_path = "s3://app-id-90177-dep-id-114232-uu-id-pee895fr5knp/"

# Strip prefix to get bucket and prefix
if s3_path.startswith("s3://"):
    path = s3_path[5:]
    bucket_name = path.split("/")[0]
    prefix = "/".join(path.split("/")[1:])

# Use boto3 to list files
s3 = boto3.client("s3")

try:
    response = s3.list_objects_v2(Bucket=bucket_name, Prefix=prefix)
    print(f"‚úÖ Successfully connected to S3 bucket: {bucket_name}")
    if "Contents" in response:
        print("üìÇ Files found:")
        for obj in response["Contents"]:
            print(f" - {obj['Key']}")
    else:
        print("‚ö†Ô∏è No files found under the given prefix.")
except Exception as e:
    print(f"‚ùå Failed to access S3 bucket: {e}")
