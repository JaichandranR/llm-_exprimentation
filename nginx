Steps to Configure API Token Security in Your Container:
Update NGINX Configuration: Use the NGINX configuration you provided, or modify it slightly as needed:

nginx
Copy code
http {
    map $http_x_api_key $api_client {
        default "";
        "test_token_123" "authorized";
    }

    server {
        listen 8888; # Listen on the specified port
        location / {
            # Validate API key
            if ($api_client = "") {
                return 401 '{"error": "Unauthorized - Invalid or missing API key"}';
            }
            # Proxy to your LLM instance
            proxy_pass http://127.0.0.1:11434;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

            # Add timeouts for LLM model
            proxy_read_timeout 300s;
        }
    }
}
Add the Configuration to Your Pod:

Include the NGINX configuration in your pod/container by mounting it as a volume or building it into the container image.
Ensure you expose the port used in the NGINX configuration (e.g., 8888).
Update the Kubernetes Deployment: Modify your Kubernetes deployment YAML to include the NGINX configuration. Here's an example:

yaml
Copy code
apiVersion: apps/v1
kind: Deployment
metadata:
  name: llm-secure
spec:
  replicas: 1
  selector:
    matchLabels:
      app: llm-secure
  template:
    metadata:
      labels:
        app: llm-secure
    spec:
      containers:
      - name: llm-model
        image: your-llm-image
        ports:
        - containerPort: 11434
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 8888
        volumeMounts:
        - name: nginx-config
          mountPath: /etc/nginx/nginx.conf
          subPath: nginx.conf
      volumes:
      - name: nginx-config
        configMap:
          name: nginx-config
Create a ConfigMap for the NGINX Configuration: Store your NGINX configuration in a Kubernetes ConfigMap:

yaml
Copy code
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
data:
  nginx.conf: |
    <Insert your NGINX configuration here>
Secure the API Token: Store the API token (test_token_123 in your example) in a Kubernetes secret:

yaml
Copy code
apiVersion: v1
kind: Secret
metadata:
  name: api-token-secret
type: Opaque
data:
  api-token: dGVzdF90b2tlbl8xMjM= # Base64 encoded value of "test_token_123"
Test the Configuration:

Deploy your updated pod with the NGINX configuration.
Make a request to the exposed port (e.g., 8888) with the correct X-API-KEY header.
Verify unauthorized requests return a 401 error.
This configuration ensures that only requests with the correct API token can access your LLM container.
