def test_get_last_compacted_index_returns_int(self):
    mock_df = MagicMock()
    mock_df.filter.return_value.select.return_value.first.return_value = [485760]
    
    with patch('src.main.python.iceberg_compaction.SparkSession.read', return_value=mock_df):
        result = iceberg_compaction.get_last_compacted_index(self.mock_spark, "table")
        self.assertIsInstance(result, int)
        self.assertEqual(result, 485760)

def test_get_last_compacted_index_returns_zero_on_exception(self):
    mock_df = MagicMock()
    mock_df.filter.side_effect = Exception("Boom")

    with patch('src.main.python.iceberg_compaction.SparkSession.read', return_value=mock_df):
        result = iceberg_compaction.get_last_compacted_index(self.mock_spark, "table")
        self.assertEqual(result, 0)
