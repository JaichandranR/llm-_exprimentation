def test_get_last_compacted_index_returns_zero_on_exception(self):
    df_mock = MagicMock()
    df_mock.filter.return_value.select.return_value.first.side_effect = Exception("Boom")

    with patch('src.main.python.iceberg_compaction.SparkSession.builder.getOrCreate', return_value=self.mock_spark):
        self.mock_spark.read.format().load.return_value = df_mock
        result = iceberg_compaction.get_last_compacted_index(self.mock_spark, "status_table", "full_table")
        self.assertEqual(result, 0)
