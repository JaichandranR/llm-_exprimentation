- id: prepare_dates
  type: io.kestra.core.tasks.debugs.Return
  format: >
    [
      {% set result = [] %}

      {# today if not weekend #}
      {% if now() | date('u') != '6' and now() | date('u') != '7' %}
        {% do result.add(now() | date('yyyy-MM-dd')) %}
      {% endif %}

      {# this month's 1st #}
      {% set month_start = now() | date('yyyy-MM-01') %}
      {% set month_start_dow = month_start | date('u') %}
      {% if month_start_dow != '6' and month_start_dow != '7' %}
        {% do result.add(month_start) %}
      {% endif %}

      {# past 6 months, 1st day #}
      {% for i in range(1, 7) %}
        {% set d = now() | dateAdd(-i, 'MONTHS') | date('yyyy-MM-01') %}
        {% set dow = d | date('u') %}
        {% if dow != '6' and dow != '7' %}
          {% do result.add(d) %}
        {% endif %}
      {% endfor %}

      {{ result | map(v => '"' ~ v ~ '"') | join(', ') }}
    ]
