REM Check if the command is for validation
echo "%*" | findstr /c:"validate" > nul
if %ERRORLEVEL% == 0 (
    echo Validation command detected. Running Python validation script...

    REM Enable delayed expansion
    setlocal EnableDelayedExpansion

    REM Extract model name from arguments
    set "model_name="
    set "found_model_name=false"
    for %%i in (%*) do (
        if "!found_model_name!"=="true" (
            set "model_name=%%i"
            set "found_model_name=false"
        )
        if "%%i"=="-m" (
            set "found_model_name=true"
        )
    )

    echo Model name: !model_name!  REM Debugging: Print model name

    REM Call Python script for validation
    set "PYTHON_SCRIPT_PATH=%dp0%check_query_optimization.py"
    python "%PYTHON_SCRIPT_PATH%" -m !model_name! --profile %DBT_PROFILE% --target %DBT_TARGET%
    exit /b
)
