- id: prepare_dates
  type: io.kestra.core.tasks.debugs.Return
  format: >
    [
      {# Create date list in a single expression using filters #}
      {{ 
        (
          [
            now() | date('u') in ['6', '7'] ? null : now() | date('yyyy-MM-dd'),
            now() | date('yyyy-MM-01') | date('u') in ['6', '7'] ? null : now() | date('yyyy-MM-01'),
            {% for i in range(1, 7) %}
              {% set d = now() | dateAdd(-i, 'MONTHS') | date('yyyy-MM-01') %}
              {{ d | date('u') in ['6', '7'] ? 'null' : '"' ~ d ~ '"' }}{% if not loop.last %},{% endif %}
            {% endfor %}
          ] 
          | reject("is null") 
          | join(", ")
        ) 
      }}
    ]
