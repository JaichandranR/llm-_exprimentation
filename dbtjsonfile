{% macro generate_acl_rows(model_group_map) %}
    {% set json_rows = [] %}

    {% for model, meta in model_group_map.items() %}
        {% if meta and meta.group and meta.privileges %}
            {% set row = {
                "user": meta.group,
                "catalog": target.database,
                "schema": target.schema,
                "table": model,
                "privileges": meta.privileges
            } %}
            {% do json_rows.append(row) %}
        {% endif %}
    {% endfor %}

    {{ return(json_rows) }}
{% endmacro %}
