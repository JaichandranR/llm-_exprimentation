with source_data as (
    SELECT 
        {{ dbt_utils.star(from=ref('fnd_fct_tmp_stg'), except=["cosmos_ingested_at"]) }}
    FROM 
        {{ ref('fnd_fct_tmp_stg') }}
    WHERE 
        FND_SRC_CD NOT IN ('KST_TEST_3', 'KST_TEST_1', 'KST_TEST_2')
        {% if is_incremental() and config.get('refresh') == 'incremental' %}
            AND updt_dt >= (SELECT max(updt_dt) FROM {{ this }})
        {% endif %}
)
SELECT * FROM source_data


DESCRIBE cosmos_nonhcd.iceberg.techsrc_raw.fnd_fct_tmp_stg;


WITH source_data AS (
    SELECT
        col1,
        col2,
        col3,
        -- Add all other columns here except cosmos_ingested_at
        colN
    FROM cosmos_nonhcd.iceberg.techsrc_raw.fnd_fct_tmp_stg
    WHERE FND_SRC_CD NOT IN ('KST_TEST_3', 'KST_TEST_1', 'KST_TEST_2')
      AND updt_dt >= (
          SELECT MAX(updt_dt)
          FROM cosmos_nonhcd.iceberg.techsrc_raw.fnd_fct_tmp
      )
)
SELECT * FROM source_data;

